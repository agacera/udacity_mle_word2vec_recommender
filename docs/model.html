---

title: Word2VeC Reommender
keywords: fastai
sidebar: home_sidebar

summary: "API details."
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 00_model.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="GensimParameters" class="doc_header"><code>class</code> <code>GensimParameters</code><a href="https://github.com/agacera/udacity_mle_word2vec_recommender/tree/master/udacity_mle_word2vec_recommender/model.py#L29" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>GensimParameters</code>(<strong><code>window</code></strong>:<code>int</code>=<em><code>10</code></em>, <strong><code>iter</code></strong>:<code>int</code>=<em><code>20</code></em>, <strong><code>sg</code></strong>:<code>int</code>=<em><code>1</code></em>, <strong><code>hs</code></strong>:<code>int</code>=<em><code>0</code></em>, <strong><code>negative</code></strong>:<code>int</code>=<em><code>10</code></em>, <strong><code>alpha</code></strong>:<code>float</code>=<em><code>0.03</code></em>, <strong><code>min_alpha</code></strong>:<code>float</code>=<em><code>0.0007</code></em>, <strong><code>seed</code></strong>:<code>int</code>=<em><code>14</code></em>, <strong><code>compute_loss</code></strong>:<code>bool</code>=<em><code>True</code></em>) :: <code>tuple</code></p>
</blockquote>
<p>GensimParameters(window, iter, sg, hs, negative, alpha, min_alpha, seed, compute_loss)</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">gensim_parameters</span> <span class="o">=</span> <span class="n">GensimParameters</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="generate_sentences_by_user" class="doc_header"><code>generate_sentences_by_user</code><a href="https://github.com/agacera/udacity_mle_word2vec_recommender/tree/master/udacity_mle_word2vec_recommender/model.py#L41" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>generate_sentences_by_user</code>(<strong><code>df</code></strong>:<code>DataFrame</code>)</p>
</blockquote>
<p>Generate the Gensin sentences for a dataframe.
Each sentence is created by joining all ratings from a user sorted by timestamp.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Movie" class="doc_header"><code>class</code> <code>Movie</code><a href="https://github.com/agacera/udacity_mle_word2vec_recommender/tree/master/udacity_mle_word2vec_recommender/model.py#L95" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Movie</code>(<strong><code>movie_id</code></strong>:<code>int</code>, <strong><code>title</code></strong>:<code>str</code>, <strong><code>genres</code></strong>:<code>str</code>)</p>
</blockquote>
<p>Movie(movie_id: int, title: str, genres: str)</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Word2VecMovieRecommender" class="doc_header"><code>class</code> <code>Word2VecMovieRecommender</code><a href="https://github.com/agacera/udacity_mle_word2vec_recommender/tree/master/udacity_mle_word2vec_recommender/model.py#L101" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Word2VecMovieRecommender</code>(<strong><code>movies_df</code></strong>:<code>DataFrame</code>, <strong><code>ratings_df</code></strong>:<code>DataFrame</code>, <strong><code>gensim_parameters</code></strong>:<a href="model.html#GensimParameters"><code>GensimParameters</code></a>, <strong><code>positive_rating_threshold</code></strong>:<code>float</code>=<em><code>3.0</code></em>, <strong><code>train_validation_ratio</code></strong>:<code>float</code>=<em><code>0.9</code></em>)</p>
</blockquote>
<p>This class encapsulates the training of recommendations plus utilities for persistance and predictions</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">movies_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/ml-latest-small/movies.csv&#39;</span><span class="p">)</span>
<span class="n">movies_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>movieId</th>
      <th>title</th>
      <th>genres</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Toy Story (1995)</td>
      <td>Adventure|Animation|Children|Comedy|Fantasy</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Jumanji (1995)</td>
      <td>Adventure|Children|Fantasy</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Grumpier Old Men (1995)</td>
      <td>Comedy|Romance</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>Waiting to Exhale (1995)</td>
      <td>Comedy|Drama|Romance</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>Father of the Bride Part II (1995)</td>
      <td>Comedy</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ratings_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/ml-latest-small/ratings.csv&#39;</span><span class="p">)</span>
<span class="n">ratings_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>userId</th>
      <th>movieId</th>
      <th>rating</th>
      <th>timestamp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>4.0</td>
      <td>964982703</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>3</td>
      <td>4.0</td>
      <td>964981247</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>6</td>
      <td>4.0</td>
      <td>964982224</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>47</td>
      <td>5.0</td>
      <td>964983815</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>50</td>
      <td>5.0</td>
      <td>964982931</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">word2vec_recommender</span> <span class="o">=</span> <span class="n">Word2VecMovieRecommender</span><span class="p">(</span>
    <span class="n">movies_df</span><span class="o">=</span><span class="n">movies_df</span><span class="p">,</span>
    <span class="n">ratings_df</span><span class="o">=</span><span class="n">ratings_df</span><span class="p">,</span>
    <span class="n">gensim_parameters</span><span class="o">=</span><span class="n">gensim_parameters</span>
<span class="p">)</span>

<span class="n">word2vec_recommender</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>movies=(9742, 3), ratings=(100836, 4), train_df=(74918, 6), validation_df=(6845, 6)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">word2vec_recommender</span><span class="o">.</span><span class="n">train_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>movieId</th>
      <th>userId</th>
      <th>rating</th>
      <th>timestamp</th>
      <th>title</th>
      <th>genres</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>43</th>
      <td>804</td>
      <td>1</td>
      <td>4.0</td>
      <td>964980499</td>
      <td>She's the One (1996)</td>
      <td>Comedy|Romance</td>
    </tr>
    <tr>
      <th>73</th>
      <td>1210</td>
      <td>1</td>
      <td>5.0</td>
      <td>964980499</td>
      <td>Star Wars: Episode VI - Return of the Jedi (1983)</td>
      <td>Action|Adventure|Sci-Fi</td>
    </tr>
    <tr>
      <th>120</th>
      <td>2018</td>
      <td>1</td>
      <td>5.0</td>
      <td>964980523</td>
      <td>Bambi (1942)</td>
      <td>Animation|Children|Drama</td>
    </tr>
    <tr>
      <th>171</th>
      <td>2628</td>
      <td>1</td>
      <td>4.0</td>
      <td>964980523</td>
      <td>Star Wars: Episode I - The Phantom Menace (1999)</td>
      <td>Action|Adventure|Sci-Fi</td>
    </tr>
    <tr>
      <th>183</th>
      <td>2826</td>
      <td>1</td>
      <td>4.0</td>
      <td>964980523</td>
      <td>13th Warrior, The (1999)</td>
      <td>Action|Adventure|Fantasy</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># sampling of interactions</span>
<span class="n">generate_sentences_by_user</span><span class="p">(</span><span class="n">word2vec_recommender</span><span class="o">.</span><span class="n">train_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[[&#39;804&#39;, &#39;1210&#39;, &#39;2018&#39;, &#39;2628&#39;, &#39;2826&#39;, &#39;3578&#39;, &#39;3617&#39;, &#39;3744&#39;, &#39;101&#39;, &#39;441&#39;]]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">word2vec_recommender</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">print_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Epoch #1 start
Epoch #1 end in 0:00:00.382095 time
Epoch #1, loss 986150.75
Epoch #2 start
Epoch #2 end in 0:00:00.386350 time
Epoch #2, loss 1799902.875
Epoch #3 start
Epoch #3 end in 0:00:00.386511 time
Epoch #3, loss 2523334.0
Epoch #4 start
Epoch #4 end in 0:00:00.386721 time
Epoch #4, loss 3221705.0
Epoch #5 start
Epoch #5 end in 0:00:00.383929 time
Epoch #5, loss 3908766.75
Epoch #6 start
Epoch #6 end in 0:00:00.391326 time
Epoch #6, loss 4555526.5
Epoch #7 start
Epoch #7 end in 0:00:00.386122 time
Epoch #7, loss 5166870.5
Epoch #8 start
Epoch #8 end in 0:00:00.386332 time
Epoch #8, loss 5777813.5
Epoch #9 start
Epoch #9 end in 0:00:00.388867 time
Epoch #9, loss 6378957.5
Epoch #10 start
Epoch #10 end in 0:00:00.382354 time
Epoch #10, loss 6979174.5
Epoch #11 start
Epoch #11 end in 0:00:00.386584 time
Epoch #11, loss 7589958.5
Epoch #12 start
Epoch #12 end in 0:00:00.386349 time
Epoch #12, loss 8186196.0
Epoch #13 start
Epoch #13 end in 0:00:00.385566 time
Epoch #13, loss 8740822.0
Epoch #14 start
Epoch #14 end in 0:00:00.385526 time
Epoch #14, loss 9275000.0
Epoch #15 start
Epoch #15 end in 0:00:00.383896 time
Epoch #15, loss 9806639.0
Epoch #16 start
Epoch #16 end in 0:00:00.383528 time
Epoch #16, loss 10337542.0
Epoch #17 start
Epoch #17 end in 0:00:00.386185 time
Epoch #17, loss 10868576.0
Epoch #18 start
Epoch #18 end in 0:00:00.382639 time
Epoch #18, loss 11395502.0
Epoch #19 start
Epoch #19 end in 0:00:00.381626 time
Epoch #19, loss 11918649.0
Epoch #20 start
Epoch #20 end in 0:00:00.381720 time
Epoch #20, loss 12438232.0
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Generating Recommendations</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">word2vec_recommender</span><span class="o">.</span><span class="n">similar_by_movie_id</span><span class="p">(</span><span class="mi">1210</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(Movie(movie_id=1210, title=&#39;Star Wars: Episode VI - Return of the Jedi (1983)&#39;, genres=&#39;Action|Adventure|Sci-Fi&#39;),
 [(Movie(movie_id=1196, title=&#39;Star Wars: Episode V - The Empire Strikes Back (1980)&#39;, genres=&#39;Action|Adventure|Sci-Fi&#39;),
   0.5592589378356934),
  (Movie(movie_id=260, title=&#39;Star Wars: Episode IV - A New Hope (1977)&#39;, genres=&#39;Action|Adventure|Sci-Fi&#39;),
   0.49443119764328003),
  (Movie(movie_id=589, title=&#39;Terminator 2: Judgment Day (1991)&#39;, genres=&#39;Action|Sci-Fi&#39;),
   0.46922799944877625),
  (Movie(movie_id=590, title=&#39;Dances with Wolves (1990)&#39;, genres=&#39;Adventure|Drama|Western&#39;),
   0.4557996094226837),
  (Movie(movie_id=66, title=&#39;Lawnmower Man 2: Beyond Cyberspace (1996)&#39;, genres=&#39;Action|Sci-Fi|Thriller&#39;),
   0.45300909876823425)])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">word2vec_recommender</span><span class="o">.</span><span class="n">similar_by_movie_id</span><span class="p">(</span><span class="mi">101</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(Movie(movie_id=101, title=&#39;Bottle Rocket (1996)&#39;, genres=&#39;Adventure|Comedy|Crime|Romance&#39;),
 [(Movie(movie_id=1883, title=&#39;Bulworth (1998)&#39;, genres=&#39;Comedy|Drama|Romance&#39;),
   0.6057734489440918),
  (Movie(movie_id=125, title=&#39;Flirting With Disaster (1996)&#39;, genres=&#39;Comedy&#39;),
   0.6005865931510925),
  (Movie(movie_id=176, title=&#39;Living in Oblivion (1995)&#39;, genres=&#39;Comedy&#39;),
   0.5515846610069275),
  (Movie(movie_id=232, title=&#39;Eat Drink Man Woman (Yin shi nan nu) (1994)&#39;, genres=&#39;Comedy|Drama|Romance&#39;),
   0.5471678972244263),
  (Movie(movie_id=1060, title=&#39;Swingers (1996)&#39;, genres=&#39;Comedy|Drama&#39;),
   0.5462595820426941)])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Plotting embeddings</p>

</div>
</div>
</div>
</div>
 

